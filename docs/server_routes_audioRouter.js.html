<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server/routes/audioRouter.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server/routes/audioRouter.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Defines routes for handling audio-related requests.
 * @module audioRouter
 */

const express = require("express");
const router = express.Router();
const multer = require("multer");

// Set up Multer storage in memory
const storage = multer.memoryStorage();

// Initialize Multer
const upload = multer({ storage: storage });

const { findPlayerRoom, processMove } = require("../modules/gameRouterFunctions");
const convertAudioToMove = require("../modules/AudioTranscription");
const axios = require('axios');
const { rooms } = require("../routes/gameRouter");
const transcribeText = require('../audio/OpenAI-API');

/**
 * Handles the audio move request.
 * @name POST/move
 * @function
 * @memberof module:audioRouter
 * @inner
 * @param {string} req.file - The uploaded audio file.
 * @param {string} req.body - The request body.
 * @param {string} req.body.voiceUrl - The URL of the voice.
 * @param {string} req.body.move - The move corresponding to the audio.
 * @param {Object} res - The response object.
 * @param {function} next - The next middleware function.
 */
router.post(
  "/move",
  upload.single("file"),
  async function (req, res, next) {
    if (!req.file) {
      return res.status(400).json({ message: "No file uploaded" });
    }
    if (!req.body) {
      return res.status(400).json({ message: "No body submitted" });
    }
    
    const transcribedText = await transcribeText(req.body.voiceUrl, req.file);
    const move = await convertAudioToMove(req.body.voiceUrl, req.file);
    
    if (move === null) {
      console.log("Could not detect valid moves, try again");
      res.status(201).json({
        message: "Could not detect valid moves, try again",
        transcription: transcribedText,
        playerTurn: true,
      });
      return;
    }
    
    return processMove(move, rooms, req, res);
  }
);

module.exports = router;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-AudioTranscription.html">AudioTranscription</a></li><li><a href="module-Game.html">Game</a></li><li><a href="module-OpenAI_API.html">OpenAI_API</a></li><li><a href="module-Room.html">Room</a></li><li><a href="module-User.html">User</a></li><li><a href="module-app.html">app</a></li><li><a href="module-audioRouter.html">audioRouter</a></li><li><a href="module-gameRouter.html">gameRouter</a></li><li><a href="module-gameRouterFunctions.html">gameRouterFunctions</a></li><li><a href="module-index.html">index</a></li><li><a href="module-indexRouter.html">indexRouter</a></li><li><a href="module-jest-dom-imports.html">jest-dom-imports</a></li><li><a href="module-kafkaService.html">kafkaService</a></li><li><a href="module-reportWebVitals.html">reportWebVitals</a></li><li><a href="module-usersRouter.html">usersRouter</a></li><li><a href="module-v2verifyRouter.html">v2verifyRouter</a></li></ul><h3>Classes</h3><ul><li><a href="module-Game-Game.html">Game</a></li><li><a href="module-Room-Room.html">Room</a></li><li><a href="module-User-User.html">User</a></li></ul><h3>Global</h3><ul><li><a href="global.html#audioBlobs">audioBlobs</a></li><li><a href="global.html#cancel">cancel</a></li><li><a href="global.html#mediaRecorder">mediaRecorder</a></li><li><a href="global.html#resetRecordingProperties">resetRecordingProperties</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#stop">stop</a></li><li><a href="global.html#streamBeingCaptured">streamBeingCaptured</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Tue May 07 2024 18:47:47 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
